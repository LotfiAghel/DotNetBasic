@typeparam TItem



@using Microsoft.AspNetCore.Components.Rendering;
@using Microsoft.AspNetCore.Components;


@using System.Collections.Generic


@using Newtonsoft.Json.Linq;

@inherits ArrayInputBase<TItem>

@{
     var tmp = Program0.getCollectionItemAttrs(Attributes);
        itemWidget = Program0.createForm4(typeof(TItem), tmp);
}
   



        @if (value != null)
        {
             <Accordion>
        <Collapse  Visible=@collapse1Visible>
             <CollapseHeader>
                  <Row>
                    <Column ColumnSize="ColumnSize.Is4">
                        <Button Clicked="@(()=>collapse1Visible = !collapse1Visible)" >@(collapse1Visible? "close":"open")</Button>
                    </Column>
                   <Column ColumnSize="ColumnSize.Is4">
                        <Button Clicked="@(()=>collapse1Visible = !collapse1Visible)" >count: @value.Count</Button>
                  </Column>
                        <Column ColumnSize="ColumnSize.Is4">
                            <Button Clicked=@setNull>set null</Button>
                        </Column>
                  </Row>
              </CollapseHeader>
            <CollapseBody>
                @{
            int j = 0;
            foreach(var context in value){
                int k = j;      
                Action<object> onChangeRefrence = (x) =>
                            {
                                Console.WriteLine("setFValue0(j, x)");
                                setValue(k, x);
                            };
                @if (!ReadOnly)
                {

                    <Button  Clicked="() => remove(k)" style="position: absolute; z-index: 10; margin: .5rem; left: 0%;">
                        <mat-icon class="material-icons" style="font-size:14px; font-weight:bold; color:red">close</mat-icon>
                    </Button>
                }
                <Div >
                    @if (!ReadOnly)
                    {

                        <Button  Clicked="() => remove(k)" style="position: absolute; z-index: 10; margin: .5rem; left: 0%;">
                            <mat-icon class="material-icons" style="font-size:14px; font-weight:bold; color:red">close</mat-icon>
                        </Button>
                    }
                    @{
                        if (itemWidget != null)
                        {
                            <div>@Program0.CreateDynamicComponent2(this, itemWidget, value[k], onChangeRefrence,null,ReadOnly)</div>;
                        }
                    }
                </Div>
               

                ++j;
            }
                  


            
            @if(!ReadOnly){
                <Button Outlined="true" Clicked="@Add">add </Button>
            }
             }
             </CollapseBody>
              </Collapse>
    </Accordion>
        }
        else
        {
            @if(!ReadOnly){
                <Button Outlined="true" Clicked="@createArray">new </Button>
            }
        }





@code
{
    public override bool inRowField()=>false;
    ComponentBase itemWidget = null;
    bool collapse1Visible = false;
    async Task createArray()
    {
        value = new List<TItem>();
        OnChange(value);

    }

    async Task Add()
    {
        value.Add(default(TItem));
        

    }
    async Task setNull()
    {
        value = null;
        OnChange(value);


    }
    
    protected override async Task OnInitializedAsync()
    {
        var tmp = Program0.getCollectionItemAttrs(Attributes);
        itemWidget = Program0.createForm4(typeof(TItem), tmp);
    }

    private void remove(int o)
    {
        if(value!=null && value.Count > o)
            value.RemoveAt(o);
    }
}

